<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Mijn Jukebox - La mia Jukebox</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #eceff1; margin: 20px; line-height: 1.5; }
        .container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); max-width: 1100px; margin: auto; }
        
        /* De grote activatie-sectie bovenaan */
        .activatie-sectie { background: #fff3e0; padding: 20px; border: 3px solid #ff9800; border-radius: 10px; margin-bottom: 20px; text-align: center; }
        .activatie-sectie h2 { margin-top: 0; color: #e65100; }
        .btn-activatie { background-color: #ff9800; color: white; padding: 15px 25px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; border-bottom: 4px solid #ef6c00; }
        .btn-activatie:hover { background-color: #fb8c00; }

        .sectie { background: #fafafa; padding: 15px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 20px; }
        h3 { margin-top: 0; color: #1a237e; }
        
        /* Audio Player Bar */
        .player-container { position: sticky; top: 0; background: #333; color: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; z-index: 100; text-align: center; }
        .track-info { margin-bottom: 10px; font-weight: bold; color: #00ff00; font-family: 'Courier New', monospace; font-size: 1.2em; }

        .btn { padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; color: white; margin-right: 5px; margin-bottom: 5px; }
        .btn-play { background-color: #007bff; }
        .btn-pause { background-color: #ffc107; color: black; }
        .btn-stop { background-color: #dc3545; }
        .btn-playlist { background-color: #6f42c1; }
        .btn-backup { background-color: #17a2b8; }
        
        #zoekveld { background-color: #e3f2fd; border: 2px solid #2196f3; font-size: 18px; margin-bottom: 10px; padding: 12px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #eee; }
        .now-playing { background-color: #e8f5e9 !important; font-weight: bold; border-left: 5px solid #28a745; }
        
        .teller { font-size: 0.9em; color: #666; font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <h1>🎶 Mijn Jukebox - La mia Jukebox</h1>

    <div class="activatie-sectie" id="start-blok">
        <h2>STAP 1: Activeer de Jukebox / Passaggio 1: Attiva il Jukebox</h2>
        <p>Klik op de knop en selecteer de muziekmap op je SD-kaart om te beginnen.</p>
        <p><small><i>Seleziona la cartella musicale per iniziare.</i></small></p>
        <input type="file" id="map-input" webkitdirectory directory multiple onchange="laadMap(this.files)" style="display:none;">
        <button class="btn-activatie" onclick="document.getElementById('map-input').click()">📁 KIES MAP / SELEZIONA CARTELLA</button>
        <div id="aantal-nummers" class="teller" style="margin-top:10px;"></div>
    </div>

    <div class="player-container">
        <div class="track-info">STREAMS: <span id="track-titel">Wachten op map...</span></div>
        <audio id="audioSpeler" onended="volgendeInPlaylist()"></audio>
        <div>
            <button class="btn btn-play" onclick="hervatAudio()">▶ PLAY</button>
            <button class="btn btn-pause" onclick="pauzeerAudio()">Ⅱ PAUSE</button>
            <button class="btn btn-stop" onclick="stopAudio()">■ STOP</button>
            <button class="btn btn-playlist" onclick="startPlaylist(false)">🔄 PLAYLIST</button>
            <button class="btn btn-playlist" style="background:#e83e8c;" onclick="startPlaylist(true)">🔀 SHUFFLE</button>
        </div>
    </div>

    <div class="sectie">
        <h3>🔍 Zoeken - Cerca</h3>
        <input type="text" id="zoekveld" onkeyup="toonNummers()" placeholder="Typ een naam... Scrivi un nome...">
        
        <table id="jukeboxTabel">
            <thead>
                <tr>
                    <th>Titel - Titolo</th>
                    <th>Bestand - File</th>
                    <th>Acties - Azioni</th>
                </tr>
            </thead>
            <tbody id="tabelInhoud"></tbody>
        </table>
    </div>

    <div class="sectie" style="text-align: center; opacity: 0.7;">
        <h3>💾 Muzieklijst downloaden (.txt)</h3>
        <button class="btn btn-backup" onclick="downloadLijst()">Lijst Opslaan / Salva Elenco</button>
    </div>
</div>

<script>
    var alleNummers = [];
    var huidigeIndex = -1;
    var isPlaylistModus = false;

    function laadMap(files) {
        alleNummers = [];
        for (var i = 0; i < files.length; i++) {
            var f = files[i];
            // Controleer op audio bestanden
            if (f.type.includes('audio') || f.name.toLowerCase().endsWith('.mp3')) {
                alleNummers.push({
                    titel: f.name.replace(/\.[^/.]+$/, "").replace(/_/g, " "),
                    pad: URL.createObjectURL(f),
                    bestandsnaam: f.name
                });
            }
        }
        
        // Alfabetisch sorteren
        alleNummers.sort(function(a, b) { return a.titel.localeCompare(b.titel); });
        
        // UI bijwerken
        document.getElementById('aantal-nummers').innerText = alleNummers.length + " nummers gevonden / brani trovati";
        document.getElementById('track-titel').innerText = "GEREED / PRONTO";
        document.getElementById('start-blok').style.background = "#e8f5e9";
        document.getElementById('start-blok').style.borderColor = "#4caf50";
        
        toonNummers();
    }

    function toonNummers() {
        var zoekterm = document.getElementById('zoekveld').value.toLowerCase();
        var tabel = document.getElementById('tabelInhoud');
        tabel.innerHTML = '';

        for (var i = 0; i < alleNummers.length; i++) {
            var n = alleNummers[i];
            if (n.titel.toLowerCase().indexOf(zoekterm) > -1) {
                var rij = tabel.insertRow(-1);
                if (huidigeIndex === i) rij.className = 'now-playing';

                rij.innerHTML = "<td>" + n.titel + "</td>" +
                                "<td><small>" + n.bestandsnaam + "</small></td>" +
                                "<td><button class='btn btn-play' onclick='speelAf(" + i + ")'>▶ Play</button></td>";
            }
        }
    }

    function speelAf(index) {
        var audio = document.getElementById('audioSpeler');
        var titelDisplay = document.getElementById('track-titel');
        huidigeIndex = index;
        
        audio.src = alleNummers[index].pad;
        titelDisplay.innerText = alleNummers[index].titel.toUpperCase();
        audio.play();
        toonNummers();
    }

    function pauzeerAudio() { document.getElementById('audioSpeler').pause(); }
    function hervatAudio() { document.getElementById('audioSpeler').play(); }
    function stopAudio() { 
        var a = document.getElementById('audioSpeler');
        a.pause(); a.currentTime = 0;
        document.getElementById('track-titel').innerText = "STOP";
    }

    function volgendeInPlaylist() {
        if (isPlaylistModus && huidigeIndex < alleNummers.length - 1) {
            speelAf(huidigeIndex + 1);
        }
    }

    function startPlaylist(shuffle) {
        if (alleNummers.length > 0) {
            isPlaylistModus = true;
            if (shuffle) {
                alleNummers.sort(function() { return 0.5 - Math.random(); });
                toonNummers();
            }
            speelAf(0);
        } else {
            alert("Eerst map laden! / Carica prima la cartella!");
        }
    }

    function downloadLijst() {
        if (alleNummers.length === 0) { return; }
        var inhoud = "JUKEBOX LIJST\n=============\n";
        for (var i = 0; i < alleNummers.length; i++) {
            inhoud += (i + 1) + ". " + alleNummers[i].titel + "\n";
        }
        var element = document.createElement('a');
        element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(inhoud));
        element.setAttribute('download', "jukebox_muzieklijst.txt");
        element.click();
    }
</script>
</body>
</html>
